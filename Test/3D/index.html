<!DOCTYPE html>
<html><head>
<meta charset="utf-8"/>

<!-- CSS.Canvasloth -->
<link type="text/css" rel="stylesheet" href="../../Canvasloth.css"/>
<!-- CSS.main -->
<style type="text/css">	
	.canvasloth { width:640px; height:480px; background:#aaf; }
	.canvasloth-mouse { background:red; }
</style>

<!-- JS.JsExt -->
<script type="text/javascript" src="../../../JsExt/ClassName.js"></script>
<script type="text/javascript" src="../../../JsExt/CSS.js"></script>
<script type="text/javascript" src="../../../JsExt/CSSAnim.js"></script>
<script type="text/javascript" src="../../../JsExt/DOMNavigate.js"></script>
<script type="text/javascript" src="../../../JsExt/DOMSelector.js"></script>
<script type="text/javascript" src="../../../JsExt/EventsManager.js"></script>
<script type="text/javascript" src="../../../JsExt/MathInterp.js"></script>
<script type="text/javascript" src="../../../JsExt/OffsetPosition.js"></script>
<!-- JS.Canvasloth -->
<script type="text/javascript" src="../../Canvasloth.js"></script>
<script type="text/javascript" src="../../Canvas/Canvas.js"></script>
<script type="text/javascript" src="../../Events/Events.js"></script>
<script type="text/javascript" src="../../Hud/Pages.js"></script>
<script type="text/javascript" src="../../Hud/DomIntIncrease.js"></script>
<script type="text/javascript" src="../../Assets/Assets.js"></script>
<script type="text/javascript" src="../../Assets/Images.js"></script>
<script type="text/javascript" src="../../Assets/Sprites.js"></script>
<script type="text/javascript" src="../../Assets/Anims.js"></script>
<script type="text/javascript" src="../../Time/Time.js"></script>
<script type="text/javascript" src="../../Math/Math.js"></script>
<script type="text/javascript" src="../../Math/Matrix.js"></script>
<script type="text/javascript" src="../../Math/Vector.js"></script>
<script type="text/javascript" src="../../Math/J3DIMath.js"></script>
<script type="text/javascript" src="../../Ctx3D/Ctx3D.js"></script>
<script type="text/javascript" src="../../Ctx3D/CameraMatrixFunctions.js"></script>
<script type="text/javascript" src="../../Ctx3D/Shaders.js"></script>
<!-- Demo -->
<script type="text/javascript" src="J3DI.js"></script>

<script>
function lg(s) { console.log(s); }

window.onload = function() {

var WebGL_Editor = {
	ready: function(canvasloth) {
		this.canvasloth = canvasloth;
		var gl = canvasloth.getCtx();
		this.program = gl._shaders.getProgram();
		
	var vertices = 
        [  1, 1, 1,  -1, 1, 1,  -1,-1, 1,   1,-1, 1,    // v0-v1-v2-v3 front
           1, 1, 1,   1,-1, 1,   1,-1,-1,   1, 1,-1,    // v0-v3-v4-v5 right
           1, 1, 1,   1, 1,-1,  -1, 1,-1,  -1, 1, 1,    // v0-v5-v6-v1 top
          -1, 1, 1,  -1, 1,-1,  -1,-1,-1,  -1,-1, 1,    // v1-v6-v7-v2 left
          -1,-1,-1,   1,-1,-1,   1,-1, 1,  -1,-1, 1,    // v7-v4-v3-v2 bottom
           1,-1,-1,  -1,-1,-1,  -1, 1,-1,   1, 1,-1    // v4-v7-v6-v5 back
    	];

    // normal array
    var normals = [
    	   0, 0, 1,   0, 0, 1,   0, 0, 1,   0, 0, 1,     // v0-v1-v2-v3 front
           1, 0, 0,   1, 0, 0,   1, 0, 0,   1, 0, 0,     // v0-v3-v4-v5 right
           0, 1, 0,   0, 1, 0,   0, 1, 0,   0, 1, 0,     // v0-v5-v6-v1 top
          -1, 0, 0,  -1, 0, 0,  -1, 0, 0,  -1, 0, 0,     // v1-v6-v7-v2 left
           0,-1, 0,   0,-1, 0,   0,-1, 0,   0,-1, 0,     // v7-v4-v3-v2 bottom
           0, 0,-1,   0, 0,-1,   0, 0,-1,   0, 0,-1     // v4-v7-v6-v5 back
       ];


    // texCoord array
    var texCoords = [
    	   1, 1,   0, 1,   0, 0,   1, 0,    // v0-v1-v2-v3 front
           0, 1,   0, 0,   1, 0,   1, 1,    // v0-v3-v4-v5 right
           1, 0,   1, 1,   0, 1,   0, 0,    // v0-v5-v6-v1 top
           1, 1,   0, 1,   0, 0,   1, 0,    // v1-v6-v7-v2 left
           0, 0,   1, 0,   1, 1,   0, 1,    // v7-v4-v3-v2 bottom
           0, 0,   1, 0,   1, 1,   0, 1    // v4-v7-v6-v5 back
       ];

    // index array
    var indices = 
        [  0, 1, 2,   0, 2, 3,    // front
           4, 5, 6,   4, 6, 7,    // right
           8, 9,10,   8,10,11,    // top
          12,13,14,  12,14,15,    // left
          16,17,18,  16,18,19,    // bottom
          20,21,22,  20,22,23   // back
      	];

      	// Set up the array of colors for the cube's faces
		var colors = [
			0, 0, 1, 1,   0, 0, 1, 1,   0, 0, 1, 1,   0, 0, 1, 1,  // v0-v1-v2-v3 front  BLEU
			1, 0, 0, 1,   1, 0, 0, 1,   1, 0, 0, 1,   1, 0, 0, 1,  // v0-v3-v4-v5 right  ROUGE
			0, 1, 0, 1,   0, 1, 0, 1,   0, 1, 0, 1,   0, 1, 0, 1,  // v0-v5-v6-v1 top    VERT
			1, 1, 1, 1,   1, 1, 1, 1,   1, 1, 1, 1,   1, 1, 1, 1,  // v1-v6-v7-v2 left   BLANC
			1, 0, 1, 1,   1, 0, 1, 1,   1, 0, 1, 1,   1, 0, 1, 1,  // v7-v4-v3-v2 bottom 
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1   // v4-v7-v6-v5 back   
		];

		this.obj = [];
		lg("mouarf");
		this.obj.push(gl._createObj(gl, "cube1", "cube", vertices, normals, texCoords, indices, colors));


		vertices = 
        [  2, 2, 2,  -2, 2, 2,  -2,-2, 2,   2,-2, 2,    // v0-v2-v2-v3 front
           2, 2, 2,   2,-2, 2,   2,-2,-2,   2, 2,-2,    // v0-v3-v4-v5 right
           2, 2, 2,   2, 2,-2,  -2, 2,-2,  -2, 2, 2,    // v0-v5-v6-v2 top
          -2, 2, 2,  -2, 2,-2,  -2,-2,-2,  -2,-2, 2,    // v2-v6-v7-v2 left
          -2,-2,-2,   2,-2,-2,   2,-2, 2,  -2,-2, 2,    // v7-v4-v3-v2 bottom
           2,-2,-2,  -2,-2,-2,  -2, 2,-2,   2, 2,-2    // v4-v7-v6-v5 back
    	];

		colors = [
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,  // v0-v1-v2-v3 front  BLEU
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,  // v0-v3-v4-v5 right  ROUGE
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,  // v0-v5-v6-v1 top    VERT
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,  // v1-v6-v7-v2 left   BLANC
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,  // v7-v4-v3-v2 bottom 
			0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1,   0, 1, 1, 1   // v4-v7-v6-v5 back   
		];
		this.obj.push(gl._createObj(gl, "cube2", "cube", vertices, normals, texCoords, indices, colors));

		// Enable all of the vertex attribute arrays.
		gl.enableVertexAttribArray(0);
		gl.enableVertexAttribArray(1);
		gl.enableVertexAttribArray(2);

		gl._camera_spherique(true);
		gl._camera_auto();
	},
	update: function(time) {
	},
	render: function(gl) {
gl._bindObjects(this.obj[0]);
		gl._pushMatrix();
		gl._drawElements(gl.TRIANGLES, this.obj[0].faces.itemNumber, gl.UNSIGNED_BYTE, 0);
		gl._popMatrix();

		gl._bindObjects(this.obj[1]);
		gl._pushMatrix();
		gl._translate(5, 5, 0);
		gl._drawElements(gl.TRIANGLES, this.obj[1].faces.itemNumber, gl.UNSIGNED_BYTE, 0);
		gl._popMatrix();
	}
};

var canvasloth = new Canvasloth({
	type : '3d',
	node : document._domSelector('.canvasloth')[0],
	app  : WebGL_Editor,
	fn   : {
		'ready'  : WebGL_Editor.ready,
		'update' : WebGL_Editor.update,
		'render' : WebGL_Editor.render
	}
});

};
</script>
</head>

<body>

	<div class="canvasloth canvasloth-dark">
		<script id="vshader" type="x-shader/x-vertex">
			uniform mat4 u_modelViewProjMatrix;
			uniform mat4 u_normalMatrix;
			uniform vec3 lightDir;
			attribute vec3 vNormal;
			attribute vec4 vColor;
			attribute vec4 vPosition;
			varying float v_Dot;
			varying vec4 v_Color;
			void main(void) {
				gl_Position = u_modelViewProjMatrix * vPosition;
				v_Color = vColor;
				vec4 transNormal = u_normalMatrix * vec4(vNormal, 1);
				v_Dot = max(dot(transNormal.xyz, lightDir), 0.0);
			}
		</script>
		<script id="fshader" type="x-shader/x-fragment">
			precision mediump float;
			varying float v_Dot;
			varying vec4 v_Color;
			void main(void) {
				gl_FragColor = vec4(v_Color.xyz * v_Dot, v_Color.a);
			}
		</script>
		<div class="canvasloth-hud-passive">
		</div>
	</div>

</body>
</html>
