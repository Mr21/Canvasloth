<!DOCTYPE html>
<html><head>
<meta charset="utf-8"/>

<!-- CSS.Canvasloth -->
<link type="text/css" rel="stylesheet" href="../../Canvasloth.css"/>
<!-- CSS.main -->
<style type="text/css">	
	.canvasloth { width:1024px; height:720px; background:#aaf; }
	.canvasloth-mouse { background:red; }
</style>

<!-- JS.JsExt -->
<script type="text/javascript" src="../../../JsExt/ClassName.js"></script>
<script type="text/javascript" src="../../../JsExt/CSS.js"></script>
<script type="text/javascript" src="../../../JsExt/CSSAnim.js"></script>
<script type="text/javascript" src="../../../JsExt/DOMNavigate.js"></script>
<script type="text/javascript" src="../../../JsExt/DOMSelector.js"></script>
<script type="text/javascript" src="../../../JsExt/EventsManager.js"></script>
<script type="text/javascript" src="../../../JsExt/MathInterp.js"></script>
<script type="text/javascript" src="../../../JsExt/OffsetPosition.js"></script>
<!-- JS.Canvasloth -->
<script type="text/javascript" src="../../Canvasloth.js"></script>
<script type="text/javascript" src="../../Events.js"></script>
<script type="text/javascript" src="../../Images.js"></script>
<script type="text/javascript" src="../../Times.js"></script>
<script type="text/javascript" src="../../HTML/Canvas.js"></script>
<script type="text/javascript" src="../../HTML/Pages.js"></script>
<script type="text/javascript" src="../../HTML/DomIntIncrease.js"></script>
<script type="text/javascript" src="../../Math/Math.js"></script>
<script type="text/javascript" src="../../Math/gl-matrix.js"></script>
<script type="text/javascript" src="../../Math/Matrix.js"></script>
<script type="text/javascript" src="../../Math/Vector.js"></script>
<script type="text/javascript" src="../../3D/Ctx.js"></script>
<script type="text/javascript" src="../../3D/Matrix.js"></script>
<script type="text/javascript" src="../../3D/Camera.js"></script>
<script type="text/javascript" src="../../3D/Shaders.js"></script>
<script type="text/javascript" src="../../3D/Lights.js"></script>
<script type="text/javascript" src="../../3D/Objects.js"></script>

<script>
function lg(s) { console.log(s); }

window.onload = function() {

var WebGL_Editor = {
	ready: function(cnv) {
		var vertices, normals, texCoords, indices, colors;
		var cnv = this.cnv = cnv;
		var gl = cnv.gl;
		this.program = cnv.shaders.program;
		
		vertices = [
			 0.5, 0.5, 0.5,  -0.5, 0.5, 0.5,  -0.5,-0.5, 0.5,   0.5,-0.5, 0.5, // v0-v1-v2-v3 front
			 0.5, 0.5, 0.5,   0.5,-0.5, 0.5,   0.5,-0.5,-0.5,   0.5, 0.5,-0.5, // v0-v3-v4-v5 right
			 0.5, 0.5, 0.5,   0.5, 0.5,-0.5,  -0.5, 0.5,-0.5,  -0.5, 0.5, 0.5, // v0-v5-v6-v1 top
			-0.5, 0.5, 0.5,  -0.5, 0.5,-0.5,  -0.5,-0.5,-0.5,  -0.5,-0.5, 0.5, // v1-v6-v7-v2 left
			-0.5,-0.5,-0.5,   0.5,-0.5,-0.5,   0.5,-0.5, 0.5,  -0.5,-0.5, 0.5, // v7-v4-v3-v2 bottom
			 0.5,-0.5,-0.5,  -0.5,-0.5,-0.5,  -0.5, 0.5,-0.5,   0.5, 0.5,-0.5  // v4-v7-v6-v5 back
		];

		// normal array
		normals = [
			 0, 0, 1,   0, 0, 1,   0, 0, 1,   0, 0, 1, // v0-v1-v2-v3 front
			 1, 0, 0,   1, 0, 0,   1, 0, 0,   1, 0, 0, // v0-v3-v4-v5 right
			 0, 1, 0,   0, 1, 0,   0, 1, 0,   0, 1, 0, // v0-v5-v6-v1 top
			-1, 0, 0,  -1, 0, 0,  -1, 0, 0,  -1, 0, 0, // v1-v6-v7-v2 left
			 0,-1, 0,   0,-1, 0,   0,-1, 0,   0,-1, 0, // v7-v4-v3-v2 bottom
			 0, 0,-1,   0, 0,-1,   0, 0,-1,   0, 0,-1  // v4-v7-v6-v5 back
			 ];

		// texCoord array
		texCoords = [
			1, 1,   0, 1,   0, 0,   1, 0, // v0-v1-v2-v3 front
			0, 1,   0, 0,   1, 0,   1, 1, // v0-v3-v4-v5 right
			1, 0,   1, 1,   0, 1,   0, 0, // v0-v5-v6-v1 top
			1, 1,   0, 1,   0, 0,   1, 0, // v1-v6-v7-v2 left
			0, 0,   1, 0,   1, 1,   0, 1, // v7-v4-v3-v2 bottom
			0, 0,   1, 0,   1, 1,   0, 1  // v4-v7-v6-v5 back
		];

		// index array
		indices = [
			 0,  1,  2,     0,  2,  3, // front
			 4,  5,  6,     4,  6,  7, // right
			 8,  9, 10,     8, 10, 11, // top
			12, 13, 14,    12, 14, 15, // left
			16, 17, 18,    16, 18, 19, // bottom
			20, 21, 22,    20, 22, 23  // back
		];

		// Set up the array of colors for the cube's faces
		colors = [
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255, // v0-v1-v2-v3 front
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255, // v0-v3-v4-v5 right
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255, // v0-v5-v6-v1 top
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255, // v1-v6-v7-v2 left
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255, // v7-v4-v3-v2 bottom
			100,60,255,255,  100,60,255,255,  100,60,255,255,  100,60,255,255  // v4-v7-v6-v5 back
		];

		this.cube1 = cnv.objects.create('cube', vertices, normals, texCoords, indices, colors);

		vertices = [
			 1, 1, 1,  -1, 1, 1,  -1,-1, 1,   1,-1, 1, // v0-v2-v2-v3 front
			 1, 1, 1,   1,-1, 1,   1,-1,-1,   1, 1,-1, // v0-v3-v4-v5 right
			 1, 1, 1,   1, 1,-1,  -1, 1,-1,  -1, 1, 1, // v0-v5-v6-v2 top
			-1, 1, 1,  -1, 1,-1,  -1,-1,-1,  -1,-1, 1, // v2-v6-v7-v2 left
			-1,-1,-1,   1,-1,-1,   1,-1, 1,  -1,-1, 1, // v7-v4-v3-v2 bottom
			 1,-1,-1,  -1,-1,-1,  -1, 1,-1,   1, 1,-1  // v4-v7-v6-v5 back
		];

		colors = [
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255, // v0-v1-v2-v3 front
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255, // v0-v3-v4-v5 right
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255, // v0-v5-v6-v1 top
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255, // v1-v6-v7-v2 left
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255, // v7-v4-v3-v2 bottom
			200,35,35,255,  200,35,35,255,  200,35,35,255,  200,35,35,255  // v4-v7-v6-v5 back
		];

		this.cube2 = cnv.objects.create('cube', vertices, normals, texCoords, indices, colors);


		//Sphere
		colors.length = vertices.length = normals.length = texCoords.length = indices.length = 0;
		
		var latitude  = 16;
		var longitude = 16;
		var radius    = 0.6;
		var sphereColor = [255, 255, 255, 255];

		for (var currentLat = 0; currentLat <= latitude; currentLat++) {
			var theta = currentLat * Math.PI / latitude;
			var sinTheta = Math.sin(theta);
			var cosTheta = Math.cos(theta);

			for (var currentLong = 0; currentLong <= longitude; currentLong++) {
				var phi = currentLong * 2 * Math.PI / longitude;
				var sinPhi = Math.sin(phi);
				var cosPhi = Math.cos(phi);

				var x = cosPhi * sinTheta;
				var y = cosTheta;
				var z = sinPhi * sinTheta;
				var u = 1 - (currentLong / longitude);
				var v = 1 - (currentLat / latitude);

				normals.push(x);
				normals.push(y);
				normals.push(z);
				colors.push(sphereColor[0]);
				colors.push(sphereColor[1]);
				colors.push(sphereColor[2]);
				colors.push(sphereColor[3]);
				vertices.push(radius * x);
				vertices.push(radius * y);
				vertices.push(radius * z);
			}
		}

		for (var currentLat = 0; currentLat < latitude; currentLat++) {
			for (var currentLong = 0; currentLong < longitude; currentLong++) {
				var first = (currentLat * (longitude + 1)) + currentLong;
				var second = first + longitude + 1;
				indices.push(first);
				indices.push(second);
				indices.push(first + 1);

				indices.push(second);
				indices.push(second + 1);
				indices.push(first + 1);
			}
		}

		this.sphere = cnv.objects.create('sphere', vertices, normals, texCoords, indices, colors);

		cnv.lights.enable()
			.ambient(0.04, 0.04, 0.04)
			.dir('sunA')
				.pos(0.6, 0.1, 1.0)
				.col(0, 0, 0.3);

		cnv.lights
			.dir('sunB')
				.pos(-0.6, -0.1, 1.5)
				.col(1, 0.5, 0);

		cnv.camera.spherique(true);
		cnv.camera.auto();
	},
	update: function(cnv) {
	},
	keydown: function(key) {
		switch (key) {
			case 65 : this.cnv.lights.dir('sunA').toggle(); break;
			case 66 : this.cnv.lights.dir('sunB').toggle(); break;
		}
	},
	render: function(cnv) {
		var gl = cnv.gl;
		cnv.matrix.push().translate(0, 0, 1.0);
			cnv.objects.bind(this.cube2);
			cnv.objects.draw(gl.TRIANGLES, this.cube2.faces.itemNumber, gl.UNSIGNED_SHORT, 0);
		cnv.matrix.pop().push().translate(-1, 2, 0.5).rotate(Math.PI/5, 0, 0, 1);
			cnv.objects.bind(this.cube1);
			cnv.objects.draw(gl.TRIANGLES, this.cube1.faces.itemNumber, gl.UNSIGNED_SHORT, 0);
		cnv.matrix.pop().push().translate(1.5, 1.7, 0.6);
			cnv.objects.bind(this.sphere);
			cnv.objects.draw(gl.TRIANGLES, this.sphere.faces.itemNumber, gl.UNSIGNED_SHORT, 0);
		cnv.matrix.pop();
	}
};

new Canvasloth({
	type : '3d',
	node : document._domSelector('.canvasloth')[0],
	app  : WebGL_Editor,
	fn   : {
		'ready'   : WebGL_Editor.ready,
		'update'  : WebGL_Editor.update,
		'render'  : WebGL_Editor.render,
		'keydown' : WebGL_Editor.keydown
	}
});

};
</script>
</head>
<body>
	<div class="canvasloth canvasloth-dark">
		<div class="canvasloth-hud-passive">
		</div>
	</div>
	<p>
		Mouvement circulaire de la camera : clique gauche enfonce + mouvement de la souris<br/>
		Avancer ou reculer la camera : roulette de la souris vers le haut ou vers le bas.
	</p>
</body>
</html>
