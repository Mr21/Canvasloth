<!DOCTYPE html>
<html>
<head>
	<title>Canvasloth</title>
	<meta charset="UTF-8"/>
	<meta property="og:title"       content="Canvasloth"/>
	<meta property="og:url"         content="https://mr21.github.io/canvasloth/"/>
	<meta property="og:image"       content="https://mr21.github.io/canvasloth/thumbnail.jpg"/>
	<meta property="og:description" content="Canvasloth is a very minimal framework to manage an HTML5-Canvas application. It manages the events, prepares the DOM for the HUD, waits until all the assets are loaded, cancels the keys repetition of the keyboard, provides a tiny time manager and that's it."/>
	<link rel="stylesheet" href="../_/fa/css/font-awesome.min.css"/>
	<link rel="stylesheet" href="../_/header.css"/>
	<link rel="stylesheet" href="src/canvasloth.css"/>
	<script src="../_/header.js"></script>
	<script src="src/canvasloth.js"></script>
	<style>
	body {
		margin: 0;
		background: #444;
		}
	.canvasloth {
		width: 640px;
		height: 480px;
		margin: 25px auto;
		}
		canvas {
			background: #222;
			}
		.canvasloth-hud-below {
			font: 11px/14px sans-serif;
			}
			.canvasloth-hud-below .console {
				position: absolute;
				overflow: hidden;
				width: 200px;
				left: 0;
				top: 0;
				bottom: 0;
				border-right: 1px dashed rgba(255,255,255,.5);
				padding: .2em .3em;
				color: #888;
				background: rgba(0,0,0,.5);
				}
				.canvasloth-hud-below .console b {
					color: #ddd;
					}
		.canvasloth-hud-above {
			}
			.canvasloth-hud-above .clear {
				position: absolute;
				right: 10px;
				bottom: 10px;
				font-weight: bold;
				}
	</style>
	<script>
	function main() {
		new Canvasloth({
			container: document.querySelector(".canvasloth"),
			context: "2d",
			autoFocus: true,
			fps: 1,
			thisApp: {
				round: function(n) { return Math.round(n * 1000) / 1000; },
				consoleWrite: function(msg) {
					var div = document.createElement("div");
					div.innerHTML = msg;
					this.el_console.appendChild(div);
					if (this.el_console.children.length > 34)
						this.el_console.removeChild(this.el_console.children[0]);
					this.el_console.scrollTop = 1000000;
				},
				concatTouchesIds: function(touches) {
					var s = "";
					for (var id in touches) {
						if (s)
							s += ", ";
						s += "<b>" + id + "</b>";
					}
					return s;
				},
				putImage: function(x, y) {
					var	w = this.img.width,
						h = this.img.height,
						sc = .2 + Math.random() * .5;
					this.ctx.save();
						this.ctx.translate(x, y);
							this.ctx.scale(sc, sc);
								this.ctx.rotate(Math.random() * Math.PI * 2);
									this.ctx.globalAlpha = .9;
									this.ctx.drawImage(this.img, 0, 0, w, h, w / -2, h / -2, w, h);
					this.ctx.restore();
				}
			},
			ready: function(cnv, ctx) {
				this.cnv = cnv;
				this.ctx = ctx;
				this.isClicked = false;
				this.el_console = cnv.container.querySelector(".console");
				this.consoleWrite("<b>ready</b> ( )");
				this.img = cnv.image("5.png");
				cnv.container.querySelector(".clear").onclick = function(e) {
					ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
				};
			},
			loop: function() {
				this.consoleWrite("loop... frameTime: " + this.round(this.cnv.frameTime()) + " (sec)");
			},
			events: {
				focus: function() {
					this.consoleWrite("<b>focus</b> ( )");
				},
				blur: function() {
					this.consoleWrite("<b>blur</b> ( )");
				},
				keyDown: function(key) {
					this.consoleWrite("key<b>Down</b> ( key <b>"+key+"</b> )");
				},
				keyUp: function(key) {
					this.consoleWrite("key<b>Up</b> ( key <b>"+key+"</b> )");
				},
				wheel: function(x, y, dx, dy) {
					this.consoleWrite("<b>wheel</b> ( x <b>"+x+"</b>, y <b>"+y+"</b>, dx <b>"+this.round(dx)+"</b>, dy <b>"+this.round(dy)+"</b> )");
				},
				mouseDown: function(x, y, btn) {
					this.consoleWrite("mouse<b>Down</b> ( x <b>"+x+"</b>, y <b>"+y+"</b>, btn <b>"+btn+"</b> )");
					this.isClicked = true;
					this.putImage(x, y);
				},
				mouseUp: function(x, y, btn) {
					this.consoleWrite("mouse<b>Up</b> ( x <b>"+x+"</b>, y <b>"+y+"</b>, btn <b>"+btn+"</b> )");
					this.isClicked = false;
				},
				mouseMove: function(x, y) {
					if (this.isClicked)
						this.putImage(x, y);
				},
				touchStart: function(id, x, y) {
					x = Math.round(x);
					y = Math.round(y);
					this.consoleWrite("touch<b>Start</b> ( id <b>"+id+"</b>, x <b>"+x+"</b>, y <b>"+y+"</b> )");
				},
				touchEnd: function(id, x, y) {
					x = Math.round(x);
					y = Math.round(y);
					this.consoleWrite("touch<b>End</b> ( id <b>"+id+"</b>, x <b>"+x+"</b>, y <b>"+y+"</b> )");
				},
				touchMove: function(touches) {
					for (var id in touches)
						this.putImage(
							touches[id].x,
							touches[id].y
						);
				}
			}
		});
	}

	// $(main);
	window.onload = main;
	</script>
</head>
<body>
	<div id="header">
		<i class="fa fa-fw fa-html5"></i>
		<h1>Canvasloth - 1.5</h1>
	</div>

	<div class="canvasloth">
		<div class="canvasloth-assets">
			<img src="5.png"/>
		</div>
		<div class="canvasloth-hud-below">
			<div class="console"></div>
		</div>
		<div class="canvasloth-hud-above">
			<button class="clear">Clear</button>
		</div>
	</div>
</body>
</html>
